# خطة التنفيذ — صلاتي حياتي

> **آخر تحديث:** فبراير 2026  
> **المراجع:** `docs/study_maps_and_locations.md`، `docs/study_prayer_times_and_mosque_location.md`

---

## ما تم إنجازه

### الخرائط وموقع المسجد
- [x] إضافة `flutter_map` + `latlong2` + `geolocator`
- [x] Map Picker (حوار + شاشة كاملة) مع موقع المستخدم الحالي
- [x] الإمام: تحديد/تعديل موقع المسجد من إعدادات المسجد
- [x] إنشاء مسجد: موقع إلزامي — شاشة كاملة تبدأ من موقع المستخدم، النقر على مكان المسجد بالضبط

### مواقيت الصلاة
- [x] Aladhan API (طريقة Muslim World League للأردن)
- [x] استبدال حزمة `adhan` بالكامل
- [x] ربط المواقيت بموقع المسجد (إمام/مشرف) وعمان (ولي أمر)
- [x] التحقق من الحضور: الإمام بدون قيد الساعة، المشرف مقيد بنافذة الحضور
- [x] عرض للمشرف: «متبقي X دقيقة لتسجيل الحضور» / «انتهت مهلة التسجيل (ساعة بعد الأذان)»

---

## تم: خريطة السوبر أدمن ✅

الهدف: سوبر أدمن يفتح خريطة واحدة يعرض عليها **كل المساجد ومواقعهم** (مع تمييز الحالة إن أمكن)، ويمكنه تعديل موقع أي مسجد.

### المهام (بالترتيب)

1. **ويدجت خريطة للعرض فقط**
   - [x] إنشاء ويدجت `MapViewerWidget`: يستقبل `List<MapViewerPoint>` (id, name, lat, lng, status?) ويعرض نقاطاً على خريطة (flutter_map).
   - [x] المساجد بدون lat/lng: مستبعدة من الخريطة؛ شاشة الخريطة تعرض رسالة إن لم يكن أي مسجد بموقع.
   - [x] تمييز لوني: معتمد = أخضر، قيد المراجعة = برتقالي، مرفوض = أحمر.

2. **شاشة خريطة كل المساجد**
   - [x] شاشة `AdminMosquesMapScreen` ومسار `/admin/mosques-map`.
   - [x] جلب كل المساجد عبر `AdminBloc`/`LoadAllMosques`.
   - [x] عرضهم في `MapViewerWidget` مع (id, name, lat, lng, status).
   - [x] النقر على نقطة: SnackBar باسم المسجد (يمكن لاحقاً فتح تفاصيل).

3. **ربط الخريطة بلوحة السوبر أدمن**
   - [x] في تبويب المساجد: زر **«عرض على الخريطة»** ينتقل إلى شاشة الخريطة.
   - [x] المساجد التي لها lat/lng فقط تظهر على الخريطة.

4. **تعديل موقع مسجد من الأدمن**
   - [x] من Bottom Sheet تفاصيل المسجد: زر «تحديد موقع المسجد على الخريطة» يفتح Map Picker (حوار).
   - [x] حفظ lat/lng عبر `AdminRepository.updateMosqueLocation` + حدث `UpdateMosqueLocation`.

### معايير القبول
- سوبر أدمن يرى خريطة واحدة بكل المساجد التي لها إحداثيات. ✅
- يمكنه فتح الخريطة من لوحة الأدمن دون الحاجة للخروج من التطبيق. ✅
- يمكنه تعديل موقع أي مسجد من تفاصيله (Bottom Sheet). ✅

---

## لاحقاً (بدون ترتيب تنفيذ ثابت)

### خرائط ومسافات
- [ ] حساب المسافة (Haversine) بين مستخدم ومسجد.
- [ ] ولي الأمر: خريطة «مساجد أطفالي» أو نص «المسجد X على بعد Y كم».
- [ ] «أقرب المساجد» لولي الأمر أو المشرف (اكتشاف مساجد).

### مواقيت وتحقق
- [ ] التحقق اليدوي: مقارنة مواقيت اليوم مع مصدر معتمد للأردن.
- [ ] (اختياري) سوبر أدمن: عرض الصلاة القادمة (عمان أو موقع المستخدم).

---

## مراجعة نهائية (بعد كل مرحلة)

- [ ] تشغيل التطبيق واختبار السيناريو يدوياً.
- [ ] عدم كسر أي دور (ولي أمر، مشرف، إمام، أدمن).
- [ ] تحديث `tasks/lessons.md` إن ظهرت أخطاء أو تحسينات.
