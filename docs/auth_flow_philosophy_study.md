# دراسة فلسفة تسجيل الدخول والتسجيل — صلاتي حياتي

> مراجعة التدفق المقترح: الدخول بقوقل أو البريد، أول مرة، التحقق من البريد، وما قد يُفوت.

---

## 1. التدفق المقترح (حرفياً)

### شاشة تسجيل الدخول (Login)
- **أول شي:** المستخدم يختار أحد الخيارين:
  - **تسجيل الدخول عن طريق قوقل**
  - **تسجيل الدخول بالبريد الإلكتروني**

### مسار قوقل
- **إذا كان مسجّل من قبل** → يدخل مباشرة ✅
- **إذا أول مرة** → نعرض له اختيار الدور (ولي أمر أو إمام) ثم يكمل الدخول ✅

### مسار البريد الإلكتروني
- **إذا أراد إنشاء حساب جديد** → يروح على **Register** (إنشاء حساب)، يملأ الاسم والإيميل وكلمة المرور، نرسل له رسالة تحقق، يتأكد أن الحساب حقيقي، بعد التفعيل يقدر يسجّل دخول بالبريد أو بقوقل (المرات اللي بعدها).
- **إذا الحساب موجود من قبل** → يسجّل دخول بالإيميل وكلمة المرور مباشرة ✅
- **إذا ما وصلته رسالة التحقق** → نوجهه: "استخدم بريداً حقيقياً" أو "تحقق من صندوق الوارد والسبام" ✅

---

## 2. تقييم الفلسفة — هل هي جيدة؟

| المعيار | التقييم |
|--------|----------|
| **وضوح الخيارين (قوقل / بريد)** | ✅ ممتاز — المستخدم يعرف من أول شاشة كيف يدخل أو ينشئ حساب. |
| **أول مرة قوقل → اختيار الدور** | ✅ صحيح — يضمن أن كل حساب له دور واضح (ولي أمر أو إمام). |
| **التسجيل بالبريد → تحقق بالإيميل** | ✅ جيد — يؤكد أن البريد حقيقي ويقلل الحسابات الوهمية. |
| **بعد التفعيل: دخول بقوقل أو بريد** | ✅ مرن — المستخدم يختار الطريقة المناسبة له لاحقاً. |

**الخلاصة:** الفلسفة واضحة ومنطقية ومناسبة لتطبيق عائلي (أولياء أمر + أئمة).

---

## 3. هل فاتك شيء؟ — نقاط للانتباه

### 3.1 ربط الحساب نفسه (البريد = قوقل)
- **السيناريو:** مستخدم أنشأ حساباً **بالبريد** (مثلاً ahmad@gmail.com) وفعّله. لاحقاً يضغط **تسجيل الدخول بقوقل** بنفس الجيميل.
- **السؤال:** هل يُعتبر نفس الحساب أم حسابان؟
- **في Supabase غالباً:** إذا الإيميل نفسه، قد يُربط تلقائياً (حسب إعدادات المشروع) أو يظهر حسابان. يُفضّل التأكد من إعدادات **Account Linking** في Supabase (ربط الهوية البريدية بهوية قوقل لنفس الإيميل) حتى لا يحدث حساب مكرر.

### 3.2 شاشة الدخول — ماذا نعرض بالضبط؟
- **خيار 1:** زرّان كبيران: "تسجيل الدخول بقوقل" و "تسجيل الدخول بالبريد الإلكتروني". عند اختيار البريد ننزل نموذج (إيميل + كلمة مرور) أو ننتقل لشاشة فرعية.
- **خيار 2:** نموذج إيميل + كلمة مرور ظاهر، وفوقه أو تحته: "أو سجّل دخولك بقوقل".
- التوصية: أن تكون الخياران واضحين من أول ما يفتح شاشة الدخول (قوقل | بريد) دون حاجة للبحث.

### 3.3 أول مرة قوقل — أين يختار الدور؟
- **من شاشة الدخول:** بعد الضغط على "تسجيل الدخول بقوقل" إذا اكتشفنا أنه مستخدم جديد، نعرض له **نافذة أو شاشة صغيرة لاختيار الدور** (ولي أمر / إمام) ثم نكمّل الدخول.
- يلزم في الكود: بعد نجاح الدخول بقوقل، التحقق إن كان المستخدم "جديد" (مثلاً من وقت إنشاء الحساب)، وعرض اختيار الدور فقط للمستخدمين الجدد.

### 3.4 رسالة التحقق — إن لم تصل
- توضيح للمستخدم: "تحقق من البريد غير المرغوب (السبام)" و "استخدم بريداً إلكترونياً حقيقياً".
- زر "إعادة إرسال الرمز" (موجود عندك في شاشة التحقق) مع تحديد زمن بين الطلبات (مثلاً دقيقة) لتجنب الإزعاج والإساءة للاستخدام.

### 3.5 نسيت كلمة المرور
- لمن سجّل بالبريد ثم نسي كلمة المرور: الإبقاء على تدفق "نسيت كلمة المرور" (إرسال رابط أو رمز إلى البريد) كما هو أو كما تخطط له.

### 3.6 المشرف (Supervisor)
- في الـ Trigger عندك أدوار: parent, imam, supervisor, child. إن كان المشرفون يسجّلون من نفس التطبيق، يلزم تحديد: هل يختارون دور "مشرف" من شاشة التسجيل أم يُضافون من قبل الإمام فقط (دعوة/ربط). هذا يحدد إن كان نضيف خيار "مشرف" في واجهة اختيار الدور أم لا.

---

## 4. ملخص التدفق الموصى به (مختصر)

| الشاشة | المحتوى |
|--------|---------|
| **تسجيل الدخول** | خياران واضحان: (1) تسجيل الدخول بقوقل — إن أول مرة نعرض اختيار الدور ثم إكمال الدخول. (2) تسجيل الدخول بالبريد — إيميل + كلمة مرور؛ إن لا يوجد حساب نوجهه لـ "إنشاء حساب". |
| **إنشاء حساب** | للراغبين بالبريد: اسم + إيميل + كلمة مرور (+ اختيار دور إن لزم). إرسال رسالة تحقق → إدخال الرمز → تفعيل الحساب. بعدها يمكن الدخول بالبريد أو بقوقل (إن رُبط نفس الإيميل). |
| **بعد التفعيل** | الدخول إما بقوقل أو بالبريد دون إعادة تحقق، مع تذكير "استخدم بريداً حقيقياً" إن لم تصل رسالة التحقق. |

---

## 5. ما تم تنفيذه حالياً vs ما يلزم لتطابق الفلسفة

| المطلوب حسب الفلسفة | الحالة الحالية |
|---------------------|-----------------|
| شاشة دخول: خيار قوقل أو بريد | ⚠️ حالياً زر قوقل مُزال من الدخول؛ البريد فقط. يلزم إعادة زر "تسجيل الدخول بقوقل" على شاشة الدخول. |
| أول مرة قوقل → اختيار الدور | ⚠️ حالياً الدور يُختار فقط من شاشة إنشاء الحساب. يلزم عند الدخول بقوقل من شاشة الدخول: كشف "مستخدم جديد" وعرض نافذة/شاشة اختيار الدور ثم تحديث الدور في DB. |
| التسجيل بالبريد → رسالة تحقق | ✅ موجود (إنشاء حساب → إرسال رمز → شاشة التحقق). |
| إن لم تصل الرسالة → توجيه "بريد حقيقي" | ✅ يمكن تعزيز النص في واجهة التحقق وإعادة الإرسال. |
| الدخول بالبريد إذا الحساب موجود | ✅ موجود (تسجيل دخول بإيميل + كلمة مرور). |

---

## 6. خلاصة

- **الفلسفة جيدة** وواضحة ومنطقية.
- **ما قد يفوت:** (1) ربط حساب البريد بحساب قوقل لنفس الإيميل في Supabase، (2) وضوح شاشة الدخول (قوقل | بريد)، (3) اختيار الدور عند أول دخول بقوقل **من شاشة الدخول** (ليس فقط من إنشاء الحساب)، (4) دور المشرف إن كان يسجّل ذاتياً.
- الخطوة العملية التالية: إعادة زر "تسجيل الدخول بقوقل" إلى شاشة الدخول، وإضافة منطق "مستخدم جديد من قوقل → عرض اختيار الدور → تحديث الدور ثم إكمال الدخول".
