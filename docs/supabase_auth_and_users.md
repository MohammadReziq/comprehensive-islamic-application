# Supabase: المصادقة (Auth) وجدول المستخدمين (users)

**إذا ظهرت "لم يتم العثور على بياناتك":** التطبيق يحاول تلقائياً ربط السجل أو إنشاءه. إذا استمر الخطأ، شغّل **003_link_user_profile_to_auth.sql** في Supabase → SQL Editor (مرة واحدة)، ثم جرّب تسجيل الدخول مرة أخرى.

## لماذا التغييرات على "الموقع" ما بتأثر على التطبيق؟

التطبيق يعتمد على **مكانين** في Supabase:

| المكان | أين تجده؟ | ماذا يفعل؟ |
|--------|-----------|------------|
| **المصادقة (Auth)** | Authentication → Users | يحفظ من يسجّل دخول (إيميل، كلمة سر، معرّف). التطبيق يتحقق منه عند تسجيل الدخول/التسجيل. |
| **جدول المستخدمين** | Table Editor → `users` | يحفظ بيانات التطبيق (اسم، دور، ربط مع المصادقة عبر `auth_id`). |

- لو غيّرت أو حذفت من **جدول users فقط** → التطبيق قد يقول "لم يتم العثور على بيانات المستخدم" (لأن الـ `auth_id` أو الربط مش متطابق)، أو العكس.
- لو حذفت من **جدول users** لكن ما حذفت من **Authentication** → الإيميل يبقى "محجوز" في المصادقة، فلو تحاول **تنشئ حساب جديد** بنفس الإيميل راح يطلع: **"هذا البريد الإلكتروني مسجّل مسبقاً"**.

يعني: التغييرات على الموقع **بتأثر**، لكن لازم تكون في المكانين حسب اللي تريد (حذف حساب = حذف من الاثنين).

---

## عشان تعمل حسابات جديدة من الصفر (نفس الإيميل)

لازم تحذف الحساب من **الاثنين**:

### 1) حذف من المصادقة (عشان يسمح يعمل تسجيل جديد بنفس الإيميل)

1. افتح **Supabase Dashboard** → **Authentication** → **Users**.
2. دور على المستخدم اللي إيميله تريد تحذفه.
3. اضغط على الصف أو على الـ ⋮ → **Delete user**.

### 2) حذف من جدول المستخدمين (عشان ما يبقى سجل قديم)

1. **Table Editor** → جدول **users**.
2. احذف الصف اللي له نفس الإيميل (أو الـ `auth_id` تبع المستخدم اللي حذفته من Auth).

بعد هيك جرّب من التطبيق **إنشاء حساب** بنفس الإيميل — المفروض يمر.

---

## "فشل جلب البيانات بعد التسجيل"

التطبيق **ينشئ سجل المستخدم بنفسه** بعد التسجيل (بدون اعتماد على توقيت الـ Trigger)، فالمفروض هالرسالة تظهر فقط لو في مشكلة شبكة أو صلاحيات. لو ظهرت: تأكد من تشغيل **001_initial_schema.sql** على الأقل (جدول `users` + سياسات RLS).

---

## ملخص

- **حذفت من الجدول (users) فقط؟** → الإيميل لسه مسجّل في المصادقة → رسالة "الحساب موجود" أو "مسجّل مسبقاً" عند إنشاء حساب جديد.
- **حذفت من المصادقة (Auth) فقط؟** → ممكن تسجّل دخول ما يمر أو يطلع "لم يتم العثور على بيانات المستخدم" لأن السجل في الجدول صار بدون ربط.
- **حذفت من الاثنين؟** → تقدر تعمل حساب جديد من الصفر بنفس الإيميل وتجرب من أول.
